'use strict';
module.exports={async up(q,S){await q.createTable('weeks',{id:{type:S.UUID,defaultValue:S.UUIDV4,primaryKey:true},cohort_id:{type:S.UUID,allowNull:false,references:{model:'cohorts',key:'id'}},week_number:{type:S.INTEGER,allowNull:false},title:{type:S.STRING(255),allowNull:false},opens_at:{type:S.DATE,allowNull:false},due_at:{type:S.DATE},live_session_at:{type:S.DATE},created_at:{type:S.DATE,allowNull:false},updated_at:{type:S.DATE,allowNull:false}});await q.addIndex('weeks',['cohort_id','week_number'],{unique:true});await q.createTable('lessons',{id:{type:S.UUID,defaultValue:S.UUIDV4,primaryKey:true},course_id:{type:S.UUID,allowNull:false,references:{model:'courses',key:'id'}},week_id:{type:S.UUID,allowNull:false,references:{model:'weeks',key:'id'}},title:{type:S.STRING(255),allowNull:false},slug:{type:S.STRING(160),allowNull:false},position:{type:S.INTEGER,allowNull:false},s3_key:{type:S.STRING(512)},poster_key:{type:S.STRING(512)},duration_seconds:{type:S.INTEGER},created_at:{type:S.DATE,allowNull:false},updated_at:{type:S.DATE,allowNull:false}});await q.addIndex('lessons',['course_id','slug'],{unique:true});await q.createTable('lesson_prerequisites',{id:{type:S.UUID,defaultValue:S.UUIDV4,primaryKey:true},lesson_id:{type:S.UUID,allowNull:false,references:{model:'lessons',key:'id'}},prerequisite_lesson_id:{type:S.UUID,allowNull:false,references:{model:'lessons',key:'id'}},created_at:{type:S.DATE,allowNull:false},updated_at:{type:S.DATE,allowNull:false}});await q.createTable('assignments',{id:{type:S.UUID,defaultValue:S.UUIDV4,primaryKey:true},week_id:{type:S.UUID,allowNull:false,references:{model:'weeks',key:'id'}},title:{type:S.STRING(255),allowNull:false},instructions:{type:S.TEXT},due_at:{type:S.DATE},created_at:{type:S.DATE,allowNull:false},updated_at:{type:S.DATE,allowNull:false}});await q.createTable('live_sessions',{id:{type:S.UUID,defaultValue:S.UUIDV4,primaryKey:true},week_id:{type:S.UUID,allowNull:false,references:{model:'weeks',key:'id'}},title:{type:S.STRING(255),allowNull:false},join_url:{type:S.STRING(1024)},start_at:{type:S.DATE},end_at:{type:S.DATE},created_at:{type:S.DATE,allowNull:false},updated_at:{type:S.DATE,allowNull:false}});await q.createTable('video_assets',{id:{type:S.UUID,defaultValue:S.UUIDV4,primaryKey:true},lesson_id:{type:S.UUID,allowNull:false,references:{model:'lessons',key:'id'}},s3_key:{type:S.STRING(512),allowNull:false},poster_key:{type:S.STRING(512)},duration_seconds:{type:S.INTEGER},created_at:{type:S.DATE,allowNull:false},updated_at:{type:S.DATE,allowNull:false}});},async down(q){for(const t of ['video_assets','live_sessions','assignments','lesson_prerequisites','lessons','weeks']) await q.dropTable(t);}};
